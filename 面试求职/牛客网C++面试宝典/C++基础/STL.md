# **标准模板库STL**

- 基本组成：常用数据结构和算法的模板的集合

- 分类

  - 广义： `Algorithm` 算法、 `Container` 容器、 `Iterator` 迭代器

  - 详细

    - `Container` 容器

      - 是一种数据结构
      - 以模板类的方法提供
      - 诸如 `list` `vector` `deques`

    - `Algorithm` 算法

      - 操作容器中的数据的模板函数
      - 可以用于从简单数组到高度复杂容器的任何数据结构

    - `Iterator` 迭代器

      - 提供了访问容器中对象的方法
      - 指针也是迭代器

    - `Function object` 仿函数

      - 函数对象
      - 重载了操作符 `operator()` 的对象

    - `Adaptor` 适配器

      - 接口类
      - 三种适配器： `Container Adaptor` `Iterator Adaptor` `Function Adaptor`

    - `Allocator` 空间配置器

      - 为STL提供空间配置的系统
      - 主要工作：对象的创建和销毁；内存的获取和释放

- `resize` 和 `reserve` 的区别

  - `capacity` ：该值在容器初始化时赋值，指的是容器能够容纳的最大的元素的个数，还不能通过下标访问

  - `size` ：指的是此时容器中实际的元素个数，可以通过下标访问

  - 区别

    - `resize` 既分配了空间，也创建了对象； `reserve` 表示容器预留空间，但并不是真正的创建对象
    - `resize` 既修改 `capacity` 大小，也修改 `size` 大小； `reserve` 只修改 `capacity` 大小，不修改 `size` 大小
    - 两者的形参个数不一样。 `resize` 带两个参数，一个表示容器大小，一个表示初始值（默认为0）； `reserve` 只带一个参数，表示容器预留的大小

- 容器动态链接可能产生的问题

  - 给动态库函数传递容器的对象本身，则会出现内存堆栈破坏的问题
  - 动态链接库函数中使用容器时，参数中只能传递容器的引用，并且保证容器的大小不能超出初始大小 

- `push_back` 和 `emplace_back` 的区别

  - `push_back` 需要先构造临时对象，再将这个对象拷贝到容器的末尾
  - `emplace_back` 直接在容器的末尾构造对象，省去拷贝过程 

---

# **常见容器**

- 顺序容器：容器不是排序的，元素插入位置同元素的值无关，而是直接保存了元素操作时的逻辑顺序

  - `vector` 

    - 动态数组
    - 元素在内存连续存放
    - 随机存取任何元素都在常数时间内完成
    - 尾部增删元素具有较佳的性能

  - `deuqe` 

    - 双向队列
    - 元素在内存中连续存放
    - 随机存取任何元素都能在常数时间内完成（仅次于 `vector` ）
    - 两端增删元素具有较佳性能（大部分情况是常数时间）

  - `list`

    - 双向链表
    - 元素在内存中不连续存放
    - 任何位置增删元素都能在常数时间内完成
    - 不支持随机存取

  - `array`

    - 大小固定的数组，不会自动退化为指针
    - 封装了一系列操作的数组

  - `forward_list`

    - 单向链表
    - 元素在内存内不连续存放
    - 不支持快速随机访问；支持任何位置快速插入和移除元素

  
- 关联容器：元素是排序的，插入任何元素都按相应的排序规则来确定其位置；通常以平衡二叉树实现

  - `set/multiset` ：关键字集合

  - `map/multimap` ：存放的元素仅有两个，第一个为 `first` 第二个为 `second` ；根据 `first` 的值对元素从小到大排序

  - `multi` 代表允许相同 `set` 关键字 或 `first` 值的存在

- 无序关联容器

  - `unordered_set/unordered_multiset`

    - 搜索、插入和移除拥有平均常数时间复杂度
    - 元素不以任何特别顺序排序，而是依赖于哈希值，允许对单元素的快速访问
    - 不可以修改容器元素

  - `unordered_map/unordered_multimap`

    - 搜索、插入和移除拥有平均常数时间复杂度
    - 元素不以任何特别顺序排序，而是依赖于哈希值，允许对单元素的快速访问

- 容器适配器：封装了基本的容器，使之具有新的函数功能

  - `stack`

    - 先进后出

  - `queue`

    - 尾部插入
    - 头部检索、修改与删除
    - 先进先出

  - `priority_queue`

    - 优先级队列
    - 优先级最高的总是位于头部

---

# **容器实现原理**

- `map`

  - 内部实现一个红黑树（非严格平衡的二叉搜索树）
  - 红黑树有自动排序的功能
  - 红黑树的每一个结点都代表 `map` 的一个元素
  - 左子树上所有结点的键值都小于根节点的键值；右子树所有结点的键值都大于根节点的键值

- `hashtable`

  - 散列表/哈希表
  - 采用函数映射的思想记录的存储位置与记录的关键字关联起来
  - 能够快速定位到要查找的记录，而不是与表中存在的记录的关键字进行比较来查找

- `deque`

  - 双向队列，元素在内存连续存放
  - 随机存取任何元素都在常数时间完成（仅次于 `vector` ）
  - 两端增删元素具有较佳性能

- `list`

  - 双向链表，元素在内存不连续存放
  - 任何位置增删元素都能在常数时间完成，不支持随机存取

---

# **空间配置器**

- 实现内存空间分配的工具
- 每一种容器的空间分配都是通过空间分配器 `alloctor` 实现的
- 将对象的构造切分开，分成空间配置和对象构造两部分
- 内存配置：通过 `alloc::allocate()` 实现
- 内存释放：通过 `alloc::deallocate()` 实现
- 对象构造：通过 `construct()` 实现
- 对象释放：通过 `destroy()` 实现
- 内存空间的配置与释放采用两级配置器：一级配置器考虑大块内存空间采用 `malloc` 和 `free` ；二级配置器考虑小块内存空间采用链表 `free_list` （ `union`  结构）维护

---

# **容器时间复杂度**

- 时间复杂度取决于底层实现

- `vector` 一维数组实现

  - 插入 `O(N)`
  - 查看 `O(1)`
  - 删除 `O(N)`

- `deque` 双向队列实现

  - 插入 `O(N)`
  - 查看 `O(1)`
  - 删除 `O(N)`

- `list` 双向链表

  - 插入 `O(1)`
  - 查看 `O(N)`
  - 删除 `O(1)`

- `map` `set` `multimap` `multiset` 采用红黑树实现

  - 插入 `O(logN)`
  - 查看 `O(logN)`
  - 删除 `O(logN)`

- `unordered_map` `unordered_set` `unordered_multimap` `unordered_multiset` 哈希表实现

  - 插入 `O(1)` 最坏 `O(N)`
  - 查看 `O(1)` 最坏 `O(N)`
  - 删除 `O(1)` 最坏 `O(N)`

---

# **迭代器**

- 迭代器失效

  - 序列容器 `vector` `deque` ：使用 `erase` 后，后边每个元素的迭代器都失效， `erase` 返回下一个有效的迭代器
  - 关联容器 `map` `set` ：使用 `erase` 后，当前元素迭代器失效；删除当前元素不会影响下一个元素的迭代器
  - `list` 使用 `erase` 方法返回下一个有效的迭代器

- 迭代器的作用

  - 用于指向顺序容器和关联容器中的元素
  - 通过迭代器可以读取它指向的元素
  - 通过非 `const` 迭代器还可以修改其指向的元素

- 迭代器和指针的区别

  - 迭代器不是指针，是类模板，表现得像指针；封装了原生指针
  - 迭代器返回的是对象引用而不是对象的值

- 迭代器分类

|      容器      | 容器上的迭代器类别 |
| :------------: | :----------------: |
|     vector     |      随机访问      |
|     deque      |      随机访问      |
|      list      |        双向        |
|  set/multiset  |        双向        |
|  map/multimap  |        双向        |
|     stack      |    不支持迭代器    |
|     queue      |    不支持迭代器    |
| priority_queue |    不支持迭代器    |


