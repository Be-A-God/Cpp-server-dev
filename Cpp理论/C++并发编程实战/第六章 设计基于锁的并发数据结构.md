# **本章内容**

- 并发数据结构的设计内涵
- 并发数据结构的设计指引
- 并发数据结构设计的实现范例

---

# **并发设计的内涵**

- 设计并发数据结构的指引

        这是一个线程安全（thread-safe）的数据结构：多线程执行的操作无论异同，每个线程所见的数据结构都是自恰的；数据不会丢失或破坏，所有不变量终将成立，恶性条件竞争也不会出现。通常，只有限定进行几种特定的并发访问，数据结构才能保证安全

        互斥使多个访问互相排斥：在一个互斥上，每次只可能让一个线程获取锁。互斥保护数据结构的方式是明令阻止真正的并发访问。以上行为称为串行化（serialization）：每个线程轮流访问受互斥保护的数据，它们只能先后串行依次访问，而非并发访问

        通常，构造函数和析构函数都要按排他方式执行。但数据结构的使用者须自行保证一点：在构造函数完成以前和析构函数开始之后，访问不会发生

        只保留最必要的串行操作，将串行操作减少至最低程度，并且最大限度地实现真正的并发访问

---

# **基于锁的并发数据结构**

    确保先锁定合适的互斥，再访问数据，并尽可能缩短持锁时间

    以标准库容器为底层进行封装实现线程安全

- 采用锁实现线程安全的栈容器

        每个访问行为都加上互斥锁,确保单一方法每次只能有一个线程访问,排他性强,程序偏向串行化,并发效率低

- 采用锁和条件变量实现线程安全的队列容器

        基于底层queue容器实现

- 采用经细粒度的锁和条件变量实现线程安全的队列容器

    [thread_safe_queue]()

---

# **设计更复杂的基于锁的并发数据结构**

- 采用锁编写线程安全的查找表
- 采用多种锁编写线程安全的链表

